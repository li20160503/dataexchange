angular.module("DexcApp.services",[]).factory("RESTService",["$http",function(e){var t=function(e){this.setURL(e),this.get=function(e,t){this.http("GET",e,t)},this.create=function(e,t){this.http("POST",e,t)},this.update=function(e,t){this.http("PUT",e,t)},this["delete"]=function(e,t){this.http("DELETE",e,t)}};return t.prototype={constructor:t,setURL:function(e){this.url=e},getURL:function(){return this.url},http:function(t,n,o){var a=this.url;n.str&&(a+=n.str),n.headers=n.headers||{"Content-Type":"application/json"},e({method:t,url:a,params:n.params,data:n.data,headers:n.headers}).success(function(e,t){o(e,t)})}},t}]);var app=angular.module("DexcApp",["ngMaterial","ngRoute","ngAnimate","ngResource","ngMessages","DexcApp.services"]).config(function(e,t,n){e.theme("default").primaryPalette("blue").accentPalette("blue-grey").warnPalette("deep-orange"),e.theme("grey").primaryPalette("blue-grey").accentPalette("blue-grey").warnPalette("deep-orange");var o="app/views";t.when("/",{templateUrl:o+"/nodes.html",controller:"NodesCtrl"}).when("/reg",{templateUrl:o+"/reg.html",controller:"NodesCtrl"}).when("/nodes",{templateUrl:o+"/nodes.html",controller:"NodesCtrl"}).when("/schedulers",{templateUrl:o+"/schedulers.html",controller:"SchedulerCtrl"}).when("/apps",{templateUrl:o+"/apps.html",controller:"AppsCtrl"})});app.factory("RestService",function(e,t){var n=new t("node/"),o=new t("app/"),a="",c="";return{node:n,app:o,NODESELECTEDID:a,APPSELECTEDID:c}}),app.controller("MainCtrl",function(e,t,n,o,a,c){e.gotoUrl=function(e){window.location.href=e},e.showRegWindow=function(e){c.show({controller:"RegAppCtrl",templateUrl:"app/views/reg.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1})},e.showSchedulerWindow=function(e){c.show({controller:"AddSchedulerCtrl",templateUrl:"app/views/scheduler.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1})}}),app.controller("SchedulerCtrl",function(e,t,n,o,a,c,l,s){}),app.controller("AddSchedulerCtrl",function(e,t,n,o,a,c,l,s){e.cancel=function(){c.cancel()},e.scheduler={name:"",trigger:"",instance:"0",status:"1"}}),app.controller("RegAppCtrl",function(e,t,n,o,a,c,l,s){e.instance={appName:"",appNameCn:"",topicName:"",callbackRoute:"",partitions:1,streamCount:1},e.cancel=function(){c.cancel()},e.regApp=function(){e.instanceForm.$valid&&l.app.create({str:"regapp",data:e.instance},function(e){e.success?(t.show(t.simple().content("应用注册成功！").position("top right").hideDelay(1500)),window.location.reload()):t.show(t.simple().content("应用注册失败！"+e.errorMessage).position("top right").hideDelay(3e3))})}}),app.controller("AppsCtrl",function(e,t,n,o,a,c,l){e.items=[],l.app.get({str:"apps"},function(t){t.success&&(e.items=t.data,console.log(t.data))}),e.menuClick=function(e,t,n){switch(l.APPSELECTEDID=t,e){case 0:c.show({controller:"AppInfoViewCtrl",templateUrl:"app/views/app_info.html",targetEvent:n,clickOutsideToClose:!0});break;case 1:c.show({controller:"SendTestDataCtrl",templateUrl:"app/views/send_data.html",targetEvent:n,clickOutsideToClose:!0});break;case 2:c.show({controller:"SendTestCBDataCtrl",templateUrl:"app/views/send_data.html",targetEvent:n,clickOutsideToClose:!0});break;case 3:c.show({controller:"NodeInfoViewCtrl",templateUrl:"app/views/node_info.html",targetEvent:n,clickOutsideToClose:!0});break;case 4:var o=c.confirm().title("确定要删除此应用吗？").content("此数据交换应用删除后数据无法恢复，请慎重操作！").ok("确定").targetEvent(n).cancel("取消");c.show(o).then(function(){console.debug("del app: "+t),l.app["delete"]({str:"del/"+t},function(e){e.success})})}}}),app.controller("SendTestDataCtrl",function(e,t,n,o,a,c,l){e.appId=l.APPSELECTEDID,e.cancel=function(){c.cancel()},e.sendData=function(){console.log(e.textmsg),l.app.get({str:"topicsendtest",params:{appid:e.appId,appkey:"1",msg:e.textmsg}},function(e){e.success&&t.show(t.simple().content("数据已发送！").position("top right").hideDelay(1500)),c.cancel()})}}),app.controller("SendTestCBDataCtrl",function(e,t,n,o,a,c,l){e.appId=l.APPSELECTEDID,e.cancel=function(){c.cancel()},e.sendData=function(){console.log(e.textmsg),l.app.get({str:"topiccbsendtest",params:{appid:e.appId,appkey:"1",msg:e.textmsg}},function(e){e.success&&t.show(t.simple().content("数据已发送！").position("top right").hideDelay(1500)),c.cancel()})}}),app.controller("NodesCtrl",function(e,t,n,o,a,c,l){e.nodes=[],l.node.get({str:"heads"},function(t){t.success&&(e.nodes=t.data,console.log(t.data))}),e.menuClick=function(e,t){0==e?l.node.get({str:"config/"+t},function(e){e.success&&c.show(c.alert().clickOutsideToClose(!0).title("查看线程池信息").content('<span style="color:gray">id: '+t+"</span><br/> <p>线程总数："+e.data.CorePoolSize+'<br/>激活线程：<span style="color: red;">'+e.data.ActiveCount+"</span></p>").ok(" 关闭 "))}):(l.NODESELECTEDID=t,c.show({controller:"NodesConsumerViewCtrl",templateUrl:"app/views/consumer_apps.html",clickOutsideToClose:!0}))}}),app.controller("AppInfoViewCtrl",function(e,t,n){e.cancel=function(){t.cancel()},n.app.get({str:n.APPSELECTEDID},function(t){t.success&&(e.app=t.data)})}),app.controller("NodeInfoViewCtrl",function(e,t,n){e.cancel=function(){t.cancel()},n.node.get({str:"byapp/"+n.APPSELECTEDID},function(t){t.success&&(e.node=t.data.split("||"))})}),app.controller("NodesConsumerViewCtrl",function(e,t,n){e.apps=[],n.node.get({str:"consumers/"+n.NODESELECTEDID},function(t){t.success&&(e.apps=t.data)}),e.cancel=function(){t.cancel()}});